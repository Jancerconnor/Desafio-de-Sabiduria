<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Desafío de la Sabiduría</title>
<style>
    body { 
        font-family: Arial, sans-serif; 
        background: #47aff5; 
        margin: 0; 
        padding: 0; 
        display: flex; 
        justify-content: center; 
        align-items: flex-start; 
        min-height: 100vh; 
    }
    .container { 
        width: 95%;          
        max-width: 400px;    
        padding: 15px; 
        background: #f8f9fa; 
        border-radius: 10px; 
        box-shadow: 0 0 12px rgba(0,0,0,0.2); 
        box-sizing: border-box;
        position: relative;
        margin: 50px auto; 
    }
    h1, h2 { text-align: center; color: #333; font-size: 1em; margin: 10px 0; }
    .welcome { text-align: center; margin: 8px 0; font-size: 0.9em; }
    .question { font-size: 0.95em; margin: 10px 0; text-align: center; }
    .timer { text-align:center; font-size:0.9em; margin: 5px 0; color: #333; }
    .options button { 
        display: block; 
        width: 100%; 
        padding: 8px; 
        margin: 4px 0; 
        border: none; 
        border-radius: 5px; 
        cursor: pointer; 
        background: #e2e3e4; 
        color: #0e0f0f; 
        font-size: 0.95em; 
        transition: 0.2s;
        text-align: left;
    }
    .options button:hover { background: #66b1eb; }
    .progress { 
        width: 100%; 
        background: #e2e1e1; 
        border-radius: 10px; 
        margin: 10px 0; 
        height: 16px; 
        overflow: hidden; 
        position: relative;
    }
    .progress-bar { 
        height: 100%; 
        width: 100%; 
        background: #3489f8; 
        transition: width 1s linear; 
    }
    .arrow { 
        position: absolute; 
        top: -12px; 
        left: 50%; 
        transform: translateX(-50%); 
        font-size: 0.9em; 
        color: rgb(202, 212, 53); 
        display: none; 
        animation: drop 0.5s ease forwards; 
    }
    @keyframes drop {
        0% { top: -12px; opacity: 1; }
        100% { top: 2px; opacity: 0; }
    }
    .modal { 
        display: none; 
        position: fixed; 
        top:0; 
        left:0; 
        width: 100%; 
        height:100%; 
        background: rgba(0,0,0,0.5); 
        justify-content:center; 
        align-items:center; 
    }
    .modal-content { 
        background:#7ce4f1; 
        padding:15px; 
        border-radius:10px; 
        text-align:center; 
        max-width:90%; 
        font-size: 0.9em;
    }
    .toast { 
        position: fixed; 
        top: 10px; 
        right: 10px; 
        background: #333; 
        color: #48eee6; 
        padding: 6px 12px; 
        border-radius: 5px; 
        display: none; 
        font-size: 0.8em;
    }
    #signature { 
        font-size: 0.6em; 
        color: #333; 
        text-align: center; 
        margin-top: 10px; 
    }
    .controls { 
        display: flex; 
        justify-content: space-between; 
        margin-top: 8px; 
        flex-wrap: wrap;
    }
    .controls button { 
        flex: 1; 
        margin: 3px; 
        padding: 8px; 
        border-radius: 5px; 
        cursor: pointer; 
        border: none; 
        font-weight: bold; 
        font-size: 0.95em;
    }
    .correct { background-color: #28a745 !important; color: #fff; }
    .incorrect { background-color: #dc3545 !important; color: #fff; }

    @media (max-width: 350px) {
        .container { padding: 10px; }
        .options button, .controls button { font-size: 0.85em; padding: 6px; }
        h1, h2 { font-size: 0.9em; }
        .question { font-size: 0.85em; }
    }
</style>
</head>
<body>
<div class="container">

    <div id="welcome-screen">
        <h1>Bienvenido a Desafío de la Sabiduría</h1>
        <p class="welcome">
            Proyecto para probar tu sabiduría sobre República Dominicana, Estados Unidos, Biblia, Inglés y Tecnología. <br>
            ¡Espero que te guste! <br>
            Atentamente, <strong>JancerMateoConnor</strong>.
        </p>
        <button onclick="showModuleSelection()">Comenzar</button>
    </div>

    <div id="module-selection" style="display:none;">
        <h2>Selecciona un módulo</h2>
        <button onclick="startModule('RD')">República Dominicana</button>
        <button onclick="startModule('US')">Estados Unidos</button>
        <button onclick="startModule('Biblia')">Biblia</button>
        <button onclick="startModule('Ingles')">Inglés</button>
        <button onclick="startModule('Tecnologia')">Tecnología</button>
    </div>

    <div id="quiz" style="display:none;">
        <div class="progress">
            <div class="progress-bar" id="progress-bar"></div>
            <div class="arrow" id="arrow">⬇</div>
        </div>
        <div class="question" id="question"></div>
        <div class="timer" id="timer">Tiempo: 20s</div>
        <div class="options" id="options"></div>
        <div class="controls">
            <button onclick="restartQuiz()">Reiniciar</button>
            <button onclick="saveProgress()">Guardar</button>
            <button onclick="chooseAnotherModule()">Otro módulo</button>
        </div>
    </div>
</div>

<div class="modal" id="modal">
    <div class="modal-content">
        <h2 id="modal-title"></h2>
        <p id="modal-text"></p>
        <button onclick="closeModal()">Cerrar</button>
        <button onclick="chooseAnotherModule()">Otro módulo</button>
    </div>
</div>

<div class="toast" id="toast"></div>
<div id="signature">jancermateo</div>

<!-- Efectos de sonido -->
<audio id="correct-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="incorrect-sound" src="https://actions.google.com/sounds/v1/cartoon/boing.ogg"></audio>

<!-- Archivos de preguntas -->
<script src="preguntas_RD.js"></script>
<script src="preguntas_US.js"></script>
<script src="preguntas_Biblia.js"></script>
<script src="preguntas_ingles.js"></script>
<script src="preguntas_tecnologia.js"></script>

<script>
let preguntas = [];
let currentIndex = 0;
let score = 0;
let answered = false;
let currentModule = '';
let timerInterval;
let tiempoRestante = 20;

// Guardamos los arrays de cada módulo en un objeto
const moduloPreguntas = {
    'RD': preguntasRD,
    'US': preguntasUS,
    'Biblia': preguntasBiblia,
    'Ingles': preguntasIngles,
    'Tecnologia': preguntasTecnologia
};

function showModuleSelection() {
    document.getElementById('welcome-screen').style.display = 'none';
    document.getElementById('module-selection').style.display = 'block';
}

function startModule(module) {
    currentModule = module;
    document.getElementById('module-selection').style.display = 'none';
    document.getElementById('quiz').style.display = 'block';

    // Cargamos progreso guardado si existe
    currentIndex = parseInt(localStorage.getItem('currentIndex_' + module)) || 0;
    score = parseInt(localStorage.getItem('score_' + module)) || 0;

    // Clonamos el array original para no alterar el módulo original
    preguntas = [...moduloPreguntas[module]];

    showQuestion();
}

function shuffleArray(array) {
    for(let i = array.length -1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function showQuestion() {
    if(currentIndex >= preguntas.length) {
        showModal('¡Has terminado!', `Puntaje: ${score}/${preguntas.length}`);
        clearInterval(timerInterval);
        return;
    }
    answered = false;
    tiempoRestante = 20;
    document.getElementById('timer').innerText = `Tiempo: ${tiempoRestante}s`;
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = '100%';
    progressBar.style.backgroundColor = '#3489f8';
    clearInterval(timerInterval);

    timerInterval = setInterval(() => {
        tiempoRestante--;
        document.getElementById('timer').innerText = `Tiempo: ${tiempoRestante}s`;
        progressBar.style.width = `${(tiempoRestante/20)*100}%`;

        if(tiempoRestante <= 5) {
            progressBar.style.backgroundColor = '#dc3545';
            progressBar.style.animation = 'blink 1s infinite';
        } else {
            progressBar.style.animation = '';
        }

        if(tiempoRestante <= 0){
            clearInterval(timerInterval);
            checkAnswer(null, null);
        }
    }, 1000);

    const q = preguntas[currentIndex];
    document.getElementById('question').innerText = q.p;
    const optionsDiv = document.getElementById('options');
    optionsDiv.innerHTML = '';

    // Barajamos opciones para mostrar
    const shuffledOptions = shuffleArray([...q.o]);
    shuffledOptions.forEach(opt => {
        const btn = document.createElement('button');
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(btn, opt);
        optionsDiv.appendChild(btn);
    });

    updateProgress();
}

function checkAnswer(button, selected) {
    if(answered) return;
    answered = true;
    clearInterval(timerInterval);

    const correct = preguntas[currentIndex].r;
    const progressBar = document.getElementById('progress-bar');
    const arrow = document.getElementById('arrow');
    let currentWidth = parseFloat(progressBar.style.width) || 0;
    let increment = 100 / preguntas.length;

    if(selected === correct){
        score++;
        if(button){
            button.innerText = `✔️ ${button.innerText}`;
            button.classList.add('correct');
        }
        document.getElementById('correct-sound').currentTime = 0;
        document.getElementById('correct-sound').play();
        showToast('¡Correcto!', '#28a745');
        progressBar.style.width = Math.min(100, currentWidth + increment) + '%';
    } else {
        if(button){
            button.innerText = `❌ ${button.innerText}`;
            button.classList.add('incorrect');
        }
        const incorrectSound = document.getElementById('incorrect-sound');
        incorrectSound.currentTime = 0;
        incorrectSound.play();
        showToast(selected ? `Incorrecto: ${correct}` : `Tiempo agotado: ${correct}`, '#dc3545');
        progressBar.style.width = Math.max(0, currentWidth - increment*0.5) + '%';
        arrow.style.display = 'block';
        setTimeout(()=>{ arrow.style.display = 'none'; }, 600);
    }

    setTimeout(() => {
        currentIndex++;
        showQuestion();
    }, 1000);
}

function restartQuiz() {
    currentIndex = 0;
    score = 0;
    // Recargamos preguntas del módulo actual
    preguntas = [...moduloPreguntas[currentModule]];
    showQuestion();
}

function saveProgress() {
    if(!currentModule) return;
    localStorage.setItem('currentIndex_' + currentModule, currentIndex);
    localStorage.setItem('score_' + currentModule, score);
    showToast('Progreso guardado', '#17a2b8');
}

function updateProgress() {
    const progress = (currentIndex / preguntas.length) * 100;
    document.getElementById('progress-bar').style.width = progress + '%';
}

function showToast(msg, color) {
    const toast = document.getElementById('toast');
    toast.innerText = msg;
    toast.style.backgroundColor = color;
    toast.style.display = 'block';
    setTimeout(() => { toast.style.display = 'none'; }, 1200);
}

function showModal(title, text) {
    document.getElementById('modal-title').innerText = title;
    document.getElementById('modal-text').innerText = text;
    document.getElementById('modal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('modal').style.display = 'none';
}

function chooseAnotherModule() {
    document.getElementById('modal').style.display = 'none';
    document.getElementById('quiz').style.display = 'none';
    document.getElementById('module-selection').style.display = 'block';
}

/* Animación parpadeo */
const style = document.createElement('style');
style.innerHTML = `@keyframes blink { 0%, 100% {opacity:1;} 50%{opacity:0;} }`;
document.head.appendChild(style);
</script>
</body>
</html>
